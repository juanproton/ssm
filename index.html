<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Juan Pedro Vallejo</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

<style>
html, body {
  margin: 0;
  padding: 0;
  font-family: Helvetica, sans-serif;

  /* CRUCIAL PARA MOBILE */
  overflow: hidden;
  position: fixed;
  width: 100%;
  height: 100%;

  touch-action: none;
}

nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  gap: 20px;
  padding: 20px;
  background: white;
  z-index: 10;
}

nav a {
  text-decoration: none;
  color: black;
  cursor: pointer;
}

.section {
  width: 100vw;
  height: 100vh;

  display: flex;
  justify-content: center;
  align-items: center;

  font-size: 40px;
}

#init { background: #e3e3ff; }
#who  { background: #ffe3e3; }
#art  { background: #e3ffe3; }

#p5-container {
  width: 100%;
  height: 100%;
  position: relative;
}
</style>
</head>

<body>

<nav>
  <a onclick="goTo(0)">INIT</a>
  <a onclick="goTo(1)">WHO</a>
  <a onclick="goTo(2)">ART</a>
</nav>

<div id="wrapper">

  <div class="section" id="init">
    <div id="p5-container"></div>
  </div>

  <div class="section" id="who">
    WHO
  </div>

  <div class="section" id="art">
    ART
  </div>

</div>

<!-- LIBS -->
<script src="https://cdn.jsdelivr.net/npm/p5@1.9.4/lib/p5.min.js"></script>
<script src="Random.js"></script>
<script src="sketch.js"></script>

<script>
let current = 0;
let isMoving = false;

const SCROLL_THRESHOLD = 70;
const ANIM_TIME = 700;

function goTo(i) {
  current = Math.max(0, Math.min(2, i));

  window.scrollTo({
    top: window.innerHeight * current,
    behavior: "smooth"
  });
}

// ===== DESKTOP =====
let wheelAccum = 0;

window.addEventListener("wheel", (e) => {
  if (isMoving) return;

  wheelAccum += e.deltaY;

  if (Math.abs(wheelAccum) < SCROLL_THRESHOLD) return;

  if (wheelAccum > 0) current++;
  else current--;

  wheelAccum = 0;

  isMoving = true;
  goTo(current);

  setTimeout(() => isMoving = false, ANIM_TIME);
});


// ===== MOBILE TOUCH (REAL) =====

let touchStartY = 0;
let touchCurrentY = 0;
let touching = false;

window.addEventListener("touchstart", (e) => {
  touching = true;
  touchStartY = e.touches[0].clientY;
}, { passive: false });

window.addEventListener("touchmove", (e) => {
  if (!touching) return;

  touchCurrentY = e.touches[0].clientY;

  e.preventDefault();
}, { passive: false });

window.addEventListener("touchend", () => {
  if (isMoving) {
    touching = false;
    return;
  }

  let delta = touchCurrentY - touchStartY;

  if (Math.abs(delta) < 50) {
    touching = false;
    return;
  }

  if (delta < 0) current++;
  else current--;

  isMoving = true;
  goTo(current);

  setTimeout(() => isMoving = false, ANIM_TIME);

  touching = false;
});


// ===== SAFETY =====
window.addEventListener("resize", () => {
  goTo(current);
});

// evitar bounce iOS
document.addEventListener("gesturestart", (e) => e.preventDefault());
</script>

</body>
</html>
